{% extends "base.html" %}
{% load staticfiles gravatar %}

{% block maps_api %}
<link rel="stylesheet" href="{% static "djangopeople/leaflet/leaflet.css" %}" />
<!--[if lte IE 8]>
    <link rel="stylesheet" href="{% static "djangopeople/leaflet/leaflet.ie.css" %}" />
<![endif]-->

{% if debug %}
	<script src="{% static "djangopeople/leaflet/leaflet-src.js" %}"></script>
	{% else %}
	<script src="{% static "djangopeople/leaflet/leaflet.js" %}"></script>
{% endif %}
<script type="text/javascript" src="{% static "djangopeople/js/maps.js" %}"></script>
{% endblock maps_api %}

{% block js %}
<script type="text/javascript">
var people = [
	// latitude, longitude, name, username, location description
	{% for person in people_list %}
		[{{ person.latitude_str }}, {{ person.longitude_str }}, "{{ person|escapejs }}", "{{ person.user.username|escapejs }}", "{{ person.location_description|escapejs }}", "{% gravatar person.user.email 40 %}", "{{ person.country.iso_code|lower }}"]{% if not forloop.last %},{% endif %}
	{% endfor %}
];
</script>

{% block map_options %}
<script type="text/javascript">
	var MAP_OPTIONS = {
		zoom: 5,
		maxZoom: 12,
		scrollWheelZoom: false,
	}
</script>
{% endblock map_options %}

{% block map_extra_options %}
{% endblock map_extra_options %}

{% block map_init %}
<script type="text/javascript">
window.onload = function() {
	var MAP = new L.Map('map', MAP_OPTIONS);
	L.tileLayer('http://{s}.tile2.opencyclemap.org/transport/{z}/{x}/{y}.png', {
	    attribution: '&copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, Imagery Â© <a href="http://www.thunderforest.com/">Thunderforest</a>',
	    maxZoom: 18
	}).addTo(MAP);

	// Plot the people as markers
	if (typeof people != 'undefined' && people.length > 0) {
		plotPeopleOnMap(people, MAP);
	}
	{% block post_map_init %}
	{% endblock post_map_init %}
};
</script>
{% endblock map_init %}


{% endblock js %}
